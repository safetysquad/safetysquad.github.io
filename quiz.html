<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Quiz ‚Äì SAFETY SQUAD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css?v=6">
</head>

<body>
<div class="app">

  <!-- ================= HEADER ================= -->
  <header>
    <div class="logo">
      <img src="logo.png" alt="Logo">
    </div>
    <div class="header-buttons">
      <button id="back-button">‚¨Ö</button>
      <button id="theme-toggle">üåì</button>
    </div>
    <h1>W√§hle einen Test</h1>
  </header>

  <!-- ================= GLOBALER BUTTON ================= -->
  <div id="global-wrong-container" style="margin: 10px 0;"></div>

  <!-- ================= QUIZ LISTE ================= -->
  <main id="quiz-list"></main>

</div>

<script src="js/quiz-data.js"></script>
<script>
function renderQuizDashboard() {
  const quizListEl = document.getElementById("quiz-list");
  const globalContainer = document.getElementById("global-wrong-container");
  quizListEl.innerHTML = "";
  globalContainer.innerHTML = "";

  let totalWrong = 0;

  Object.keys(quizzes).forEach((quizId, index) => {
    const quiz = quizzes[quizId];
    const savedWrong = JSON.parse(localStorage.getItem(`safety_${quizId}_wrong`) || "[]");
    const best = localStorage.getItem(`safety_${quizId}_best`);

    totalWrong += savedWrong.length;

    // Quiz-Block
    const block = document.createElement("div");
    block.className = "quiz-block";

    // Quiz-Link
    const link = document.createElement("a");
    link.href = `quiz-run.html?id=${quizId}`;
    link.className = "btn quiz-link";
    link.innerHTML = `<span>Quiz ${index + 1} (${quiz.length} F.)</span>`;
    
    // Badge
    const badge = document.createElement("span");
    badge.classList.add("quiz-badge");
    if (!best) {
      badge.innerText = "Neu";
      badge.classList.add("new");
    } else {
      badge.innerText = `${best}%`;
      if (Number(best) === 100) badge.classList.add("gold");
    }
    link.appendChild(badge);
    block.appendChild(link);

    // Retry-Button pro Quiz (falls Fragen falsch)
    if (savedWrong.length > 0) {
      const retryBtn = document.createElement("a");
      retryBtn.href = `quiz-run.html?id=${quizId}&retryWrong=1`;
      retryBtn.className = "btn warn";
      retryBtn.innerText = `‚ùå Falsche Fragen wiederholen (${savedWrong.length})`;
      block.appendChild(retryBtn);
    }

    quizListEl.appendChild(block);
  });

  // Globaler Button f√ºr alle falschen Fragen
  if (totalWrong > 0) {
    const btn = document.createElement("a");
    btn.href = "quiz-run.html?globalWrong=1";
    btn.className = "btn warn";
    btn.innerText = `‚ùå Alle falschen Fragen wiederholen (${totalWrong})`;
    globalContainer.appendChild(btn);
  }
}

// Seite laden
document.addEventListener("DOMContentLoaded", renderQuizDashboard);
</script>

</body>
</html>
