<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Quiz â€“ SAFETY SQUAD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css?v=6">
</head>

<body>
<div class="app">

  <!-- ================= HEADER ================= -->
  <header class="header-bar">
    <button class="burger" onclick="toggleMenu()">â˜°</button>
    <div class="header-text">
      <h1>ğŸ“ Quiz</h1>
      <p>WÃ¤hle einen Test</p>
    </div>
  </header>

  <!-- ================= BURGER MENÃœ ================= -->
  <div id="moreMenu" class="more-menu hidden">
    <a href="stats.html">ğŸ“Š Statistik</a>
    <a href="index.html">â¬… Startseite</a>
  </div>

  <!-- ================= GLOBALER BUTTON ================= -->
  <div id="global-wrong-container" style="margin: 10px 0;"></div>

  <!-- ================= QUIZ LISTE ================= -->
  <main id="quiz-list"></main>

</div>

<!-- ================= SCRIPTS ================= -->
<script>
// ======================
// Dashboard rendern (dynamisch)
// ======================
function renderQuizDashboard() {
  const quizListEl = document.getElementById("quiz-list");
  const globalContainer = document.getElementById("global-wrong-container");
  quizListEl.innerHTML = "";
  globalContainer.innerHTML = "";

  let totalWrong = 0;

  Object.keys(quizzes).forEach(quizId => {
    const quiz = quizzes[quizId];
    const savedWrong = JSON.parse(localStorage.getItem(`safety_${quizId}_wrong`) || "[]");
    const best = localStorage.getItem(`safety_${quizId}_best`);

    totalWrong += savedWrong.length;

    // ================= Quiz-Block =================
    const block = document.createElement("div");
    block.className = "quiz-block";
    block.style.marginBottom = "10px";

    const link = document.createElement("a");
    link.href = `quiz-run.html?id=${quizId}`;
    link.className = "btn quiz-link";
    link.style.marginRight = "10px";
    link.innerText = quizId;

    const badge = document.createElement("span");
    badge.classList.add("quiz-badge");
    badge.style.marginLeft = "5px";
    if (!best) {
      badge.innerText = "Neu";
      badge.classList.add("new");
    } else {
      badge.innerText = `${best}%`;
      if (Number(best) === 100) badge.classList.add("gold");
    }
    link.appendChild(badge);
    block.appendChild(link);

    // Retry-Button pro Quiz
    if (savedWrong.length > 0) {
      const retryBtn = document.createElement("a");
      retryBtn.href = `quiz-run.html?id=${quizId}&retryWrong=1`;
      retryBtn.className = "btn warn small";
      retryBtn.innerText = `âŒ Falsche Fragen wiederholen (${savedWrong.length})`;
      block.appendChild(retryBtn);
    }

    quizListEl.appendChild(block);
  });

  // Globaler Button fÃ¼r alle falschen Fragen
  if (totalWrong > 0) {
    const btn = document.createElement("a");
    btn.href = "quiz-run.html?globalWrong=1";
    btn.className = "btn warn large";
    btn.innerText = `âŒ Alle falschen Fragen wiederholen (${totalWrong})`;
    globalContainer.appendChild(btn);
  }
}

// ================= Burger MenÃ¼ =================
function toggleMenu() {
  const menu = document.getElementById("moreMenu");
  if (menu) menu.classList.toggle("hidden");
}

// ======================
// Seite laden
// ======================
document.addEventListener("DOMContentLoaded", renderQuizDashboard);
</script>

</body>
</html>
