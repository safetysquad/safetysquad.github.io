<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Quiz ‚Äì SAFETY SQUAD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css?v=6">
  <style>
    .quiz-block {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }

    .quiz-block .btn {
      flex: 1; /* gleiche Breite */
      display: flex;
      flex-direction: column; /* Text + Badge untereinander */
      justify-content: center;
      align-items: center;
      padding: 8px 12px;
      text-align: center;
      min-width: 0; /* verhindert √úberlauf auf kleinen Bildschirmen */
    }

    .quiz-link {
      display: flex;
      flex-direction: column; /* Text oben, Badge unten */
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .quiz-link span {
      font-size: 1rem;
      font-weight: bold;
    }

    .quiz-badge {
      display: block;       /* Badge in eigene Zeile */
      margin-top: 4px;      /* Abstand zum Text */
      font-weight: bold;
      font-size: 0.9rem;
    }

    #global-wrong-container .btn {
      width: 100%;
      display: block;
      text-align: center;
      padding: 10px 0;
      margin-top: 10px;
    }
  </style>
</head>

<body>
<div class="app">

  <!-- ================= HEADER ================= -->
  <header class="header-bar">
    <button class="burger" onclick="toggleMenu()">‚ò∞</button>
    <div class="header-text">
      <h1>üìù Quiz</h1>
      <p>W√§hle einen Test</p>
    </div>
  </header>

  <!-- ================= BURGER MEN√ú ================= -->
  <div id="moreMenu" class="more-menu hidden">
    <a href="stats.html">üìä Statistik</a>
    <a href="index.html">‚¨Ö Startseite</a>
  </div>

  <!-- ================= GLOBALER BUTTON ================= -->
  <div id="global-wrong-container" style="margin: 10px 0;"></div>

  <!-- ================= QUIZ LISTE ================= -->
  <main id="quiz-list"></main>

</div>

<!-- ================= SCRIPTS ================= -->
<script src="quiz-data.js"></script>
<script>
function renderQuizDashboard() {
  const quizListEl = document.getElementById("quiz-list");
  const globalContainer = document.getElementById("global-wrong-container");
  quizListEl.innerHTML = "";
  globalContainer.innerHTML = "";

  let totalWrong = 0;

  Object.keys(quizzes).forEach((quizId, index) => {
    const quiz = quizzes[quizId];
    const savedWrong = JSON.parse(localStorage.getItem(`safety_${quizId}_wrong`) || "[]");
    const best = localStorage.getItem(`safety_${quizId}_best`);

    totalWrong += savedWrong.length;

    // Quiz-Block
    const block = document.createElement("div");
    block.className = "quiz-block";

    // Quiz-Link
    const link = document.createElement("a");
    link.href = `quiz-run.html?id=${quizId}`;
    link.className = "btn quiz-link";
    link.innerHTML = `<span>Quiz ${index + 1} (${quiz.length} Fragen)</span>`;
    
    // Badge (Prozentzahl oder "Neu") unter Text
    const badge = document.createElement("span");
    badge.classList.add("quiz-badge");
    if (!best) {
      badge.innerText = "Neu";
      badge.classList.add("new");
    } else {
      badge.innerText = `${best}%`;
      if (Number(best) === 100) badge.classList.add("gold");
    }
    link.appendChild(badge);
    block.appendChild(link);

    // Retry-Button pro Quiz (falls Fragen falsch)
    if (savedWrong.length > 0) {
      const retryBtn = document.createElement("a");
      retryBtn.href = `quiz-run.html?id=${quizId}&retryWrong=1`;
      retryBtn.className = "btn warn";
      retryBtn.innerText = `‚ùå Falsche Fragen wiederholen (${savedWrong.length})`;
      block.appendChild(retryBtn);
    }

    quizListEl.appendChild(block);
  });

  // Globaler Button f√ºr alle falschen Fragen
  if (totalWrong > 0) {
    const btn = document.createElement("a");
    btn.href = "quiz-run.html?globalWrong=1";
    btn.className = "btn warn large";
    btn.innerText = `‚ùå Alle falschen Fragen wiederholen (${totalWrong})`;
    globalContainer.appendChild(btn);
  }
}

// Burger Men√º
function toggleMenu() {
  const menu = document.getElementById("moreMenu");
  if (menu) menu.classList.toggle("hidden");
}

// Seite laden
document.addEventListener("DOMContentLoaded", renderQuizDashboard);
</script>

</body>
</html>
